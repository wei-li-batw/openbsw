<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta content="EclipseOpenBSWDocumentation" name="dox_trace_storage" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Initialization and Task Creation &mdash; Eclipse OpenBSW Documentation  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/rtd_theme_overrides.css?v=6fd0d55b" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/graphviz.css?v=eafc0fe6" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/colors.css?v=3cafd8aa" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/colored_table.css?v=34b816d5" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/header.css?v=e632285e" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/dox_util_colors.css?v=dd14b177" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/dox_trace.css?v=60d3f72c" />

  
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../../../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../../../../_static/copybutton.js?v=f281be69"></script>
        <script src="../../../../../_static/dox_trace.js?v=40719b51"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
    <link rel="next" title="Runnables" href="02_runnables.html" />
    <link rel="prev" title="Developer Documentation" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../doc/dev/index.html" class="icon icon-home">
            Eclipse OpenBSW Documentation
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Learning</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/dev/learning/overview.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/dev/learning/SysTest/HW_Testing_Guide.html">Hardware Testing Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Guidelines</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/dev/guidelines/conventions/index.html">Coding Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/dev/guidelines/practices.html">Coding Practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/dev/guidelines/formatting/index.html">Formatting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/dev/guidelines/unittests.html">Unit Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/dev/guidelines/module.html">Module Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/dev/guidelines/documentation.html">Module Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/dev/guidelines/diagrams.html">Diagrams</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/dev/guidelines/3rdparty.html">Third Party Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/dev/guidelines/commit_message.html">Commit Message</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/dev/guidelines/pull_request.html">Pull Request</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Platforms</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/dev/platforms/posix/index.html">POSIX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/dev/platforms/s32k148evb/index.html">S32K148 Evaluation Board</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Features</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/dev/features/storage.html">Persistent Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/dev/features/functional_safety.html">Functional Safety</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Software Modules</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../../../../doc/dev/modules/common.html">Common</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../../../../doc/dev/modules/common.html#bsw">BSW</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../../async/doc/index.html">async - Asynchronous Execution Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../asyncConsole/doc/index.html">asyncConsole - Asynchronous Console</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">asyncFreeRtos</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="index.html">Developer Documentation</a><ul class="current">
<li class="toctree-l5 current"><a class="current reference internal" href="#">Initialization and Task Creation</a></li>
<li class="toctree-l5"><a class="reference internal" href="02_runnables.html">Runnables</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../user/index.html">User Documentation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../asyncImpl/doc/index.html">asyncImpl</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../bsp/doc/index.html">bsp</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../common/doc/index.html">common</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cpp2can/doc/index.html">cpp2can - CAN Abstraction Layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cpp2ethernet/doc/index.html">cpp2ethernet - Ethernet Abstractions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../docan/doc/index.html">docan - Diagnostics over CAN</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../io/doc/index.html">io - IO Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../lifecycle/doc/index.html">lifecycle - App Lifecycle Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../logger/doc/index.html">logger - Logger module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../loggerIntegration/doc/index.html">loggerIntegration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../lwipSocket/doc/index.html">lwipSocket - LwIP v2 Socket Abstraction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../middleware/doc/index.html">middleware</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../platform/doc/index.html">platform - Platform Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../runtime/doc/index.html">runtime</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stdioConsoleInput/doc/index.html">stdioConsoleInput</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../storage/doc/index.html">storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../timer/doc/index.html">timer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../transport/doc/index.html">transport - Transport Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../transportRouterSimple/doc/index.html">transportRouterSimple</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../uds/doc/index.html">uds - Unified Diagnostic Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../util/doc/index.html">util</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../doc/dev/modules/common.html#bsp">BSP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../doc/dev/modules/common.html#safety">Safety</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/dev/modules/posix.html">Posix</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/dev/modules/s32k1xx.html">S32K1xx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/dev/modules/executables.html">Executables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/dev/modules/mocks.html">Mocks</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../tools/UdsTool/doc/index.html">UdsTool</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../tools/puncover_tool/doc/index.html">Puncover</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../doc/dev/index.html">Eclipse OpenBSW Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../doc/dev/index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../../../doc/dev/modules/common.html">Common</a> &raquo;</li>
        
          <li><a href="../index.html">asyncFreeRtos</a> &raquo;</li>
        
          <li><a href="index.html">Developer Documentation</a> &raquo;</li>
        
        <li>Initialization and Task Creation</li>
    

    

      <li class="wy-breadcrumbs-aside">

        <!-- DOCUMENT STATUS -->

        

        <!-- DATA CLASSIFICATION -->

        

      </li>

    
  </ul>

  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="initialization-and-task-creation">
<span id="initialization"></span><h1>Initialization and Task Creation<a class="headerlink" href="#initialization-and-task-creation" title="Link to this heading"></a></h1>
<p>Let’s first recap how the user initializes the system and declares task as described in the user
documentation. Take a look at the very simple example shown below. Based on this, we will walk
through the initialization sequence and how it is actually implemented.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">enum</span><span class="w"> </span><span class="nc">TASK</span>
<span class="linenos"> 2</span><span class="p">{</span>
<span class="linenos"> 3</span><span class="w">    </span><span class="n">TASK_EXAMPLE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="linenos"> 4</span><span class="w">    </span><span class="n">ASYNC_CONFIG_TASK_COUNT</span><span class="p">,</span>
<span class="linenos"> 5</span><span class="p">};</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="o">::</span><span class="n">async</span><span class="o">::</span><span class="n">AsyncBinding</span><span class="o">::</span><span class="n">AdapterType</span><span class="o">::</span><span class="n">IdleTask</span><span class="o">&lt;</span><span class="mi">1024</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">IDLE_TASK</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;idle&quot;</span><span class="p">};</span>
<span class="linenos"> 8</span><span class="o">::</span><span class="n">async</span><span class="o">::</span><span class="n">AsyncBinding</span><span class="o">::</span><span class="n">AdapterType</span><span class="o">::</span><span class="n">TimerTask</span><span class="o">&lt;</span><span class="mi">1024</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">TIME_TASK</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;timer&quot;</span><span class="p">};</span>
<span class="linenos"> 9</span><span class="o">::</span><span class="n">async</span><span class="o">::</span><span class="n">AsyncBinding</span><span class="o">::</span><span class="n">AdapterType</span><span class="o">::</span><span class="n">Task</span><span class="o">&lt;</span><span class="n">TASK_EXAMPLE</span><span class="p">,</span><span class="w"> </span><span class="mi">1024</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="o">&gt;</span><span class="w"> </span><span class="n">EXAMPLE_TASK</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;example&quot;</span><span class="p">};</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="kt">void</span><span class="w"> </span><span class="nf">startApp</span><span class="p">()</span>
<span class="linenos">12</span><span class="p">{</span>
<span class="linenos">13</span><span class="w">    </span><span class="o">::</span><span class="n">async</span><span class="o">::</span><span class="n">scheduleAtFixedRate</span><span class="p">(</span><span class="n">TASK_EXAMPLE</span><span class="p">,</span><span class="w"> </span><span class="p">...);</span>
<span class="linenos">14</span><span class="p">}</span>
<span class="linenos">15</span>
<span class="linenos">16</span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<span class="linenos">17</span><span class="p">{</span>
<span class="linenos">18</span><span class="w">    </span><span class="o">::</span><span class="n">async</span><span class="o">::</span><span class="n">AsyncBinding</span><span class="o">::</span><span class="n">AdapterType</span><span class="o">::</span><span class="n">run</span><span class="p">(</span>
<span class="linenos">19</span><span class="w">        </span><span class="o">::</span><span class="n">async</span><span class="o">::</span><span class="n">AsyncBinding</span><span class="o">::</span><span class="n">AdapterType</span><span class="o">::</span><span class="n">StartAppFunctionType</span><span class="o">::</span><span class="n">create</span><span class="o">&lt;&amp;</span><span class="n">startApp</span><span class="o">&gt;</span><span class="p">());</span>
<span class="linenos">20</span><span class="p">}</span>
</pre></div>
</div>
<p>In line 9 we specify the task <em>example</em> along with the mandatory idle and timer tasks. It is
declared as a global variable and is uniquely identified by an integer id, in our case the enum
value <code class="code docutils literal notranslate"><span class="pre">TASK_EXAMPLE</span></code>. For each declared task we create during initialization of the system a
native <em>FreeRTOS</em> task, into which we can schedule runnables using the known <em>async</em> API. In this
example we schedule a cyclically executed runnable in line 13.</p>
<p>From usage perspective this is straight forward, but how do we get from the globally declared
variables to the <em>FreeRTOS</em> tasks created during initialization? The key idea is implemented within
the <code class="code docutils literal notranslate"><span class="pre">TaskInitializer</span></code> class, which inherits from the <code class="code docutils literal notranslate"><span class="pre">StaticRunnable</span></code> class. Don’t get
confused by the name <em>Runnable</em> here, it has nothing to do with the runnables we later schedule
through the <em>async</em> API. As you can see below, we call the <code class="code docutils literal notranslate"><span class="pre">TaskInitializer::create()</span></code> method
from within our <code class="code docutils literal notranslate"><span class="pre">Task</span></code> constructor which is executed during static initialization of our
global <code class="code docutils literal notranslate"><span class="pre">Task</span></code> objects.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">TaskImpl</span><span class="o">&lt;</span><span class="n">Adapter</span><span class="p">,</span><span class="w"> </span><span class="n">Context</span><span class="p">,</span><span class="w"> </span><span class="n">StackSize</span><span class="o">&gt;::</span><span class="n">TaskImpl</span><span class="p">(...)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">TaskInitializer</span><span class="o">&lt;</span><span class="n">Adapter</span><span class="o">&gt;::</span><span class="n">create</span><span class="p">(</span><span class="n">Context</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">_task</span><span class="p">,</span><span class="w"> </span><span class="n">_stack</span><span class="p">,</span><span class="w"> </span><span class="n">taskFunction</span><span class="p">,</span><span class="w"> </span><span class="n">taskConfig</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Within the <code class="code docutils literal notranslate"><span class="pre">TaskInitializer::create</span></code> method we allocate a task initializer object storing all
the necessary data which is needed to create a <em>FreeRTOS</em> task, for example a pointer to the stack
memory, the name of the task, … During initialization at runtime, we then iterate over these task
initializer objects and create a task for each one of it. But how do we iterate over these objects?
The secret for this lies within the <code class="code docutils literal notranslate"><span class="pre">StaticRunnable</span></code> implementation which constructs a linked
list and allows to iterate over it using the <code class="code docutils literal notranslate"><span class="pre">StaticRunnable::run</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">StaticRunnable</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">StaticRunnable</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">_next</span><span class="p">(</span><span class="n">_first</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">_first</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">T</span><span class="o">*&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In summary, we create a linked list of task initializer objects during the static initialization
of our globally declared task variables. Great, this already answers a lot of questions on how the
declared tasks are created at runtime. There is just one more interesting implementation detail to
look at, namely where we allocate our task initializer objects. Since we only need them a single
time during initialization but never again during runtime, it would be inefficient to permanently
allocate memory for them, e.g. within the task objects. Therefore, we utilize the anyway allocated
stack memory of the task to place our task initializer objects into as shown below.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="n">TaskInitializer</span><span class="o">&lt;</span><span class="n">Adapter</span><span class="o">&gt;::</span><span class="n">create</span><span class="p">(...)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">new</span><span class="w"> </span><span class="p">(</span><span class="n">stackSlice</span><span class="p">.</span><span class="n">data</span><span class="p">())</span><span class="w"> </span><span class="n">TaskInitializer</span><span class="p">(...);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>And that’s all that happens during the initialization. The user declares global variables with the
wanted tasks which are put into a linked list during static initialization. At runtime we iterate
over this list, create <em>FreeRTOS</em> tasks using <code class="code docutils literal notranslate"><span class="pre">xTaskCreateStatic</span></code> and maintain a lookup within
the static <code class="code docutils literal notranslate"><span class="pre">_taskContexts</span></code> array which can be indexed by the integer id. Finally, the system
is started using <code class="code docutils literal notranslate"><span class="pre">vTaskStartScheduler</span></code> and the <code class="code docutils literal notranslate"><span class="pre">FREERTOS_TASKS_C_ADDITIONS_INIT</span></code> hook is
called, in which we execute the user provided <code class="code docutils literal notranslate"><span class="pre">startApp</span></code> function.</p>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025 Accenture.</p>
  </div>

  <div role="footer_string">
    <p>Documentation from 2025-12-10 03:10:46, official build.</p>

    
      <a href="../../../../../_sources/libs/bsw/asyncFreeRtos/doc/developer/01_initialization.rst.txt" rel="nofollow"> View page source</a>
    

  </div>

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>